{"version":3,"sources":["../migrations/v12_0_1-1560888400-webchat_add_payload.ts"],"names":["migration","info","description","type","up","bp","database","schema","hasColumn","success","message","alterTable","table","jsonb","error"],"mappings":";;;;;;AAEA,MAAMA,SAA8B,GAAG;AACrCC,EAAAA,IAAI,EAAE;AACJC,IAAAA,WAAW,EAAG,gDADV;AAEJC,IAAAA,IAAI,EAAE;AAFF,GAD+B;AAKrCC,EAAAA,EAAE,EAAE,OAAO;AAAEC,IAAAA;AAAF,GAAP,KAAyE;AAC3E,QAAI,MAAMA,EAAE,CAACC,QAAH,CAAYC,MAAZ,CAAmBC,SAAnB,CAA6B,gBAA7B,EAA+C,SAA/C,CAAV,EAAqE;AACnE,aAAO;AAAEC,QAAAA,OAAO,EAAE,IAAX;AAAiBC,QAAAA,OAAO,EAAE;AAA1B,OAAP;AACD;;AAED,QAAI;AACF,YAAML,EAAE,CAACC,QAAH,CAAYC,MAAZ,CAAmBI,UAAnB,CAA8B,gBAA9B,EAAgDC,KAAK,IAAI;AAC7DA,QAAAA,KAAK,CAACC,KAAN,CAAY,SAAZ;AACD,OAFK,CAAN;AAIA,aAAO;AAAEJ,QAAAA,OAAO,EAAE,IAAX;AAAiBC,QAAAA,OAAO,EAAE;AAA1B,OAAP;AACD,KAND,CAME,OAAOI,KAAP,EAAc;AACd,aAAO;AAAEL,QAAAA,OAAO,EAAE,KAAX;AAAkBC,QAAAA,OAAO,EAAEI,KAAK,CAACJ;AAAjC,OAAP;AACD;AACF;AAnBoC,CAAvC;eAsBeV,S","sourceRoot":"/usr/src/app/modules/channel-excel/src/backend","sourcesContent":["import * as sdk from 'botpress/sdk'\n\nconst migration: sdk.ModuleMigration = {\n  info: {\n    description: `Adds payload field to the table excel_messages`,\n    type: 'database'\n  },\n  up: async ({ bp }: sdk.ModuleMigrationOpts): Promise<sdk.MigrationResult> => {\n    if (await bp.database.schema.hasColumn('excel_messages', 'payload')) {\n      return { success: true, message: 'Column payload already exists, skipping...' }\n    }\n\n    try {\n      await bp.database.schema.alterTable('excel_messages', table => {\n        table.jsonb('payload')\n      })\n\n      return { success: true, message: 'Field created successfully' }\n    } catch (error) {\n      return { success: false, message: error.message }\n    }\n  }\n}\n\nexport default migration\n"]}