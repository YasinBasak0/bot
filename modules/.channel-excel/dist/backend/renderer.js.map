{"version":3,"sources":["renderer.ts"],"names":["convertPayload","data","metadata","extraProps","botUrl","BOT_URL","common","collectFeedback","__collectFeedback","type","title","url","image","text","elements","items","map","subtitle","actions","picture","eval","buttons","a","action","replace","payload","Error","includes"],"mappings":";;;;;;;AAEO,MAAMA,cAAc,GAAIC,IAAD,IAA2B;AACvD,QAAM;AAAEC,IAAAA,QAAF;AAAYC,IAAAA;AAAZ,MAA2BF,IAAjC;AACA,QAAMG,MAAM,GAAGD,UAAH,aAAGA,UAAH,uBAAGA,UAAU,CAAEE,OAA3B;AAEA,QAAMC,MAAM,GAAG;AACbC,IAAAA,eAAe,EAAEL,QAAF,aAAEA,QAAF,uBAAEA,QAAQ,CAAEM,iBADd;AAEbN,IAAAA;AAFa,GAAf;;AAKA,MAAID,IAAI,CAACQ,IAAL,KAAc,OAAlB,EAA2B;AACzB,WAAO;AACLA,MAAAA,IAAI,EAAE,MADD;AAELC,MAAAA,KAAK,EAAET,IAAI,CAACS,KAFP;AAGLC,MAAAA,GAAG,EAAG,GAAEP,MAAO,GAAEH,IAAI,CAACW,KAAM,EAHvB;AAIL,SAAGN;AAJE,KAAP;AAMD,GAPD,MAOO,IAAIL,IAAI,CAACQ,IAAL,KAAc,UAAlB,EAA8B;AACnC,WAAO;AACLI,MAAAA,IAAI,EAAE,GADD;AAELJ,MAAAA,IAAI,EAAE,UAFD;AAGL,SAAGH,MAHE;AAILQ,MAAAA,QAAQ,EAAEb,IAAI,CAACc,KAAL,CAAWC,GAAX,CAAe,CAAC;AAAEN,QAAAA,KAAF;AAASE,QAAAA,KAAT;AAAgBK,QAAAA,QAAhB;AAA0BC,QAAAA;AAA1B,OAAD,MAA0C;AACjER,QAAAA,KADiE;AAEjEO,QAAAA,QAFiE;AAGjEE,QAAAA,OAAO,EAAEP,KAAK,GAAI,GAAER,MAAO,GAAEQ,KAAM,EAArB,GAAyBQ,IAAI,CAAC,MAAD,CAHsB;AAIjEC,QAAAA,OAAO,EAAE,CAACH,OAAO,IAAI,EAAZ,EAAgBF,GAAhB,CAAoBM,CAAC,IAAI;AAChC,cAAIA,CAAC,CAACC,MAAF,KAAa,eAAjB,EAAkC;AAChC,mBAAO;AACLd,cAAAA,IAAI,EAAE,eADD;AAELC,cAAAA,KAAK,EAAEY,CAAC,CAACZ,KAFJ;AAGLG,cAAAA,IAAI,EAAES,CAAC,CAACT;AAHH,aAAP;AAKD,WAND,MAMO,IAAIS,CAAC,CAACC,MAAF,KAAa,UAAjB,EAA6B;AAAA;;AAClC,mBAAO;AACLd,cAAAA,IAAI,EAAE,UADD;AAELC,cAAAA,KAAK,EAAEY,CAAC,CAACZ,KAFJ;AAGLC,cAAAA,GAAG,YAAEW,CAAC,CAACX,GAAJ,2CAAE,OAAOa,OAAP,CAAe,SAAf,EAA0BpB,MAA1B;AAHA,aAAP;AAKD,WANM,MAMA,IAAIkB,CAAC,CAACC,MAAF,KAAa,UAAjB,EAA6B;AAClC,mBAAO;AACLd,cAAAA,IAAI,EAAE,UADD;AAELC,cAAAA,KAAK,EAAEY,CAAC,CAACZ,KAFJ;AAGLe,cAAAA,OAAO,EAAEH,CAAC,CAACG;AAHN,aAAP;AAKD,WANM,MAMA;AACL,kBAAM,IAAIC,KAAJ,CAAW,sCAAqCJ,CAAC,CAAC,QAAD,CAAW,gCAA5D,CAAN;AACD;AACF,SAtBQ;AAJwD,OAA1C,CAAf;AAJL,KAAP;AAiCD,GAlCM,MAkCA,IAAIrB,IAAI,CAACQ,IAAL,KAAc,MAAd,IAAyBR,IAAI,CAACY,IAAN,CAAsBc,QAAtB,CAA+B,gBAA/B,CAA5B,EAA8E;AACnF,WAAO,EACL,GAAG1B,IADE;AAELY,MAAAA,IAAI,EAAGZ,IAAI,CAACY,IAAN,CAAsBW,OAAtB,CAA8B,gBAA9B,EAAgD,EAAhD,CAFD;AAGLf,MAAAA,IAAI,EAAE;AAHD,KAAP;AAKD;;AAED,SAAOR,IAAP;AACD,CA3DM","sourceRoot":"/usr/src/app/modules/channel-excel/src/backend","sourcesContent":["import * as sdk from 'botpress/sdk'\n\nexport const convertPayload = (data: sdk.Content.All) => {\n  const { metadata, extraProps } = data\n  const botUrl = extraProps?.BOT_URL\n\n  const common = {\n    collectFeedback: metadata?.__collectFeedback,\n    metadata\n  }\n\n  if (data.type === 'image') {\n    return {\n      type: 'file',\n      title: data.title,\n      url: `${botUrl}${data.image}`,\n      ...common\n    }\n  } else if (data.type === 'carousel') {\n    return {\n      text: ' ',\n      type: 'carousel',\n      ...common,\n      elements: data.items.map(({ title, image, subtitle, actions }) => ({\n        title,\n        subtitle,\n        picture: image ? `${botUrl}${image}` : eval('null'),\n        buttons: (actions || []).map(a => {\n          if (a.action === 'Say something') {\n            return {\n              type: 'say_something',\n              title: a.title,\n              text: a.text\n            }\n          } else if (a.action === 'Open URL') {\n            return {\n              type: 'open_url',\n              title: a.title,\n              url: a.url?.replace('BOT_URL', botUrl)\n            }\n          } else if (a.action === 'Postback') {\n            return {\n              type: 'postback',\n              title: a.title,\n              payload: a.payload\n            }\n          } else {\n            throw new Error(`Webchat carousel does not support \"${a['action']}\" action-buttons at the moment`)\n          }\n        })\n      }))\n    }\n  } else if (data.type === 'text' && (data.text as string).includes('!#select_range')) {\n    return {\n      ...data,\n      text: (data.text as string).replace('!#select_range', ''),\n      type: 'select_range'\n    }\n  }\n\n  return data\n}\n"]}